version: '2'
services:
  zabbix-server:
    image: zabbix/zabbix-server-mysql:alpine-3.2.5
    ports:
     - "10051:10051"
#    volumes:
#     - /etc/localtime:/etc/localtime:ro
#     - /etc/timezone:/etc/timezone:ro 
#     - ./zbx_env/usr/lib/zabbix/alertscripts:/usr/lib/zabbix/alertscripts:ro
#     - ./zbx_env/usr/lib/zabbix/externalscripts:/usr/lib/zabbix/externalscripts:ro
#     - ./zbx_env/var/lib/zabbix/modules:/var/lib/zabbix/modules:ro
#     - ./zbx_env/var/lib/zabbix/enc:/var/lib/zabbix/enc:ro
#     - ./zbx_env/var/lib/zabbix/ssh_keys:/var/lib/zabbix/ssh_keys:ro
#     - ./zbx_env/var/lib/zabbix/mibs:/var/lib/zabbix/mibs:ro
    links:
     - mysql-server:mysql-server
     - zabbix-java-gateway:zabbix-java-gateway
    ulimits:
      nproc: 65535
      nofile:
       soft: 20000
       hard: 40000
    mem_limit: 256m
    env_file:
     - .env_db_mysql
     - .env_srv
    user: root
  

  zabbix-web-nginx-mysql:
    image: zabbix/zabbix-web-nginx-mysql:alpine-3.2-latest
    ports:
     - "8081:80"
     - "8443:443"
    links:
     - mysql-server:mysql-server
     - zabbix-server:zabbix-server
    mem_limit: 128m
    env_file:
     - .env_db_mysql
     - .env_web
    user: root


  zabbix-java-gateway:
    image: zabbix/zabbix-java-gateway:alpine-3.2-latest
    ports:
     - "10052:10052"
    env_file:
     - .env_java
    user: root


  mysql-server:
    image: mysql:5.7
    volumes:
     - ./dbdata:/var/lib/mysql
    env_file:
     - .env_db_mysql
    user: root
